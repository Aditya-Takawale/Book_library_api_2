<!DOCTYPE html>
<html>
<head>
    <title>Book Library API - Enhanced Swagger UI</title>
    <link rel="stylesheet" type="text/css" href="https://unpkg.com/swagger-ui-dist@5.9.0/swagger-ui.css" />
    <style>
        .auth-success-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 10000;
            font-family: Arial, sans-serif;
            font-size: 14px;
            max-width: 350px;
            animation: slideIn 0.3s ease-out;
        }
        
        .auth-success-notification .close-btn {
            float: right;
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            margin-left: 10px;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .auth-success-notification h4 {
            margin: 0 0 8px 0;
            font-size: 16px;
        }
        
        .auth-success-notification p {
            margin: 4px 0;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <div id="swagger-ui"></div>
    <script src="https://unpkg.com/swagger-ui-dist@5.9.0/swagger-ui-bundle.js"></script>
    <script>
        window.onload = function() {
            const ui = SwaggerUIBundle({
                url: '/openapi.json',
                dom_id: '#swagger-ui',
                presets: [
                    SwaggerUIBundle.presets.apis,
                    SwaggerUIBundle.presets.standalone
                ],
                requestInterceptor: function(request) {
                    // Monitor authorization headers
                    if (request.headers.Authorization && request.headers.Authorization.startsWith('Bearer ')) {
                        console.log('üîê Authorization header detected:', request.headers.Authorization.substring(0, 20) + '...');
                    }
                    return request;
                },
                responseInterceptor: function(response) {
                    // Check for successful auth verification
                    if (response.url.includes('/auth/verify') && response.status === 200) {
                        try {
                            const data = JSON.parse(response.text);
                            if (data.status === 'success') {
                                showAuthSuccessNotification(data);
                            }
                        } catch (e) {
                            console.log('Could not parse auth verification response');
                        }
                    }
                    return response;
                }
            });
            
            function showAuthSuccessNotification(data) {
                // Remove any existing notifications
                const existing = document.querySelector('.auth-success-notification');
                if (existing) {
                    existing.remove();
                }
                
                // Create notification
                const notification = document.createElement('div');
                notification.className = 'auth-success-notification';
                notification.innerHTML = `
                    <button class="close-btn" onclick="this.parentElement.remove()">√ó</button>
                    <h4>üéâ Authorization Successful!</h4>
                    <p><strong>User:</strong> ${data.user.email}</p>
                    <p><strong>Role:</strong> ${data.user.role}</p>
                    <p><strong>Permissions:</strong> ${data.user.permissions.length} active</p>
                    <p><strong>Status:</strong> You are now authenticated and can access protected endpoints!</p>
                `;
                
                document.body.appendChild(notification);
                
                // Auto-remove after 8 seconds
                setTimeout(() => {
                    if (notification.parentElement) {
                        notification.remove();
                    }
                }, 8000);
            }
            
            // Add custom CSS for better auth button styling
            const style = document.createElement('style');
            style.textContent = `
                .swagger-ui .auth-wrapper .authorize {
                    background: linear-gradient(135deg, #007acc, #005fa3) !important;
                    border-color: #007acc !important;
                }
                .swagger-ui .auth-wrapper .authorize:hover {
                    background: linear-gradient(135deg, #005fa3, #004080) !important;
                }
            `;
            document.head.appendChild(style);
        };
    </script>
</body>
</html>
